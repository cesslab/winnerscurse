{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
    Round {{ round_number }}
{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'expected/exp.css' %}">
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.js"></script>#}
{#    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.0.3/chroma.min.js"></script>#}
{#    <script src="https://cdn.jsdelivr.net/gh/emn178/chartjs-plugin-labels/src/chartjs-plugin-labels.js"></script>#}
{% endblock %}

{% block content %}
    <div class="grid-container">
        <div class="item item-1">
            <div>
                <p>Consider the following lottery wheel. How much are you willing to pay to play this lottery?</p>
            </div>

{#            <div class="lottery-header">#}
{#                <h4 class="text-center"><u>Lottery of type {{ display_round_number }}</u></h4>#}
{#            </div>#}
{#            <div class="lottery">#}
{#                <p class="text-center">#}
{#                    {% if treatment == 'cv' %}#}
{#                        With a probability of {{ p }}% you get a value v between {{ alpha }} and {{ beta }}, <br>otherwise you#}
{#                        get 0.#}
{#                    {% else %}#}
{#                        With a probability p between {{ alpha }}% and {{ beta }}%, you get a value of {{ value }}, <br>otherwise#}
{#                        you get 0.#}
{#                    {% endif %}#}
{#                </p>#}
{#            </div>#}
        </div>
        <div class="item item-2">
            <div class="pie-container">
                <div class="item">
                    <img id="pie" src="{% static img|safe %}" alt="chart">
                </div>
                <div class="item">
                    <img id="legend" src="{% static legend|safe %}" alt="legend">
                </div>
            </div>
{#            <canvas id="pie-chart" width="950" height="600"></canvas>#}
        </div>
    </div>



    <div class="grid-bid-container">
        <div class="text-center lottery-header">
            <h4><u>Your Valuation</u></h4>
        </div>
        <div>
            <input
                    type="number"
                    id="id_expected_value"
                    name="expected_value"
                    min="{{ min_bid }}"
                    max="{{ max_bid }}"
                    step="1"
                    class="center-input form-control"
                    value="{{ form.expected_value.value|default_if_none:"" }}"
                    placeholder="Enter Your Expected Value" required>

            {% if form.expected_value.errors %}
                <div class="alert alert-danger">
                    {{ form.expected_value.errors }}
                </div>
            {% endif %}
        </div>
    </div>

    {% next_button %}

    <div class="modal" id="modal" tabindex="-1" role="dialog">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Notification</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <p>Your valuation is larger than the highest possible outcome of the lottery.</p>
            <p>Would you like to proceed with this value?</p>
          </div>
          <div class="modal-footer">
            <button type="submit" class="btn btn-primary otree-btn-next ">Yes</button>
            <button type="button" class="modal-btn btn btn-secondary" data-dismiss="modal">No</button>
          </div>
        </div>
      </div>
    </div>

{% endblock %}

{% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var max = {{ max_outcome|json }};

            function entryMonitor(event) {
                let source = event.target;
                if (source.value > max) {
                    $('#modal').modal('show');
                }
                console.log(source.value);
            }

            document.getElementById('id_expected_value').addEventListener('keyup', entryMonitor);
        });
    </script>
{% endblock %}

